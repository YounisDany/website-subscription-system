
# تدفق المستخدم (User Flow)

## 1. تدفق تسجيل الدخول (Login Flow)
1. يبدأ المستخدم بزيارة صفحة تسجيل الدخول (`auth/login.php`).
2. يدخل المستخدم اسم المستخدم/البريد الإلكتروني وكلمة المرور.
3. يتم التحقق من صحة البيانات في الخادم (`includes/login_process.php`).
4. إذا كانت البيانات صحيحة:
   أ. يتم إنشاء جلسة للمستخدم.
   ب. يتم توجيه المستخدم إلى لوحة التحكم الخاصة به (`user/dashboard.php`).
5. إذا كانت البيانات غير صحيحة:
   أ. يتم عرض رسالة خطأ للمستخدم.
   ب. يبقى المستخدم في صفحة تسجيل الدخول.

## 2. تدفق إنشاء حساب (Registration Flow)
1. يبدأ المستخدم بزيارة صفحة إنشاء حساب (`auth/register.php`).
2. يدخل المستخدم المعلومات المطلوبة (اسم المستخدم، البريد الإلكتروني، كلمة المرور).
3. يتم التحقق من صحة البيانات وتوفر اسم المستخدم/البريد الإلكتروني في الخادم (`includes/register_process.php`).
4. إذا كانت البيانات صحيحة وغير موجودة:
   أ. يتم إنشاء حساب جديد للمستخدم في قاعدة البيانات.
   ب. يتم توجيه المستخدم إلى صفحة تسجيل الدخول أو لوحة التحكم مباشرة.
5. إذا كانت البيانات غير صحيحة أو موجودة مسبقًا:
   أ. يتم عرض رسالة خطأ للمستخدم.
   ب. يبقى المستخدم في صفحة إنشاء الحساب.

## 3. تدفق لوحة تحكم المستخدم (User Dashboard Flow)
1. بعد تسجيل الدخول بنجاح، يتم توجيه المستخدم إلى لوحة التحكم (`user/dashboard.php`).
2. تقوم لوحة التحكم بعرض معلومات الاشتراك الخاصة بالمستخدم (تاريخ البدء، تاريخ الانتهاء، المدة المتبقية).
3. إذا كان الاشتراك نشطًا:
   أ. يتم عرض محتوى الداشبورد كاملاً.
   ب. يتم تحديث المدة المتبقية ديناميكيًا باستخدام JavaScript.
4. إذا كان الاشتراك منتهيًا:
   أ. يتم عرض رسالة تفيد بانتهاء الاشتراك.
   ب. يتم تعطيل الوصول إلى محتوى الداشبورد الرئيسي.
   ج. يتم توجيه المستخدم إلى صفحة تجديد الاشتراك أو الاتصال بالدعم.

## 4. تدفق لوحة تحكم الإدارة (Admin Dashboard Flow)
1. يقوم المسؤول بتسجيل الدخول إلى لوحة تحكم الإدارة (`admin/login.php`).
2. بعد تسجيل الدخول بنجاح، يتم توجيه المسؤول إلى لوحة التحكم (`admin/dashboard.php`).
3. تقوم لوحة التحكم بعرض قائمة بالمستخدمين واشتراكاتهم.
4. يمكن للمسؤول:
   أ. إضافة مستخدمين جدد.
   ب. تعديل معلومات المستخدمين الحاليين.
   ج. حذف المستخدمين.
   د. تحديد مدة الاشتراك لمستخدم معين (بالثواني والدقائق).
   ه. تفعيل أو تعطيل اشتراك المستخدم يدويًا.
   و. عرض سجلات النشاط (اختياري).


# 🚀 نظام إدارة الاشتراكات المتقدم

نظام إدارة الاشتراكات هو تطبيق ويب متكامل ومتقدم مطور باستخدام PHP و MySQL و Bootstrap، مصمم لإدارة المستخدمين والاشتراكات بدقة عالية وأمان فائق. يوفر النظام تحكمًا كاملاً في مدة الاشتراك، مع إمكانية تحديدها بالثواني والدقائق، مما يجعله مثاليًا لمجموعة واسعة من التطبيقات.

---

## 🌟 الميزات الرئيسية

| الميزة | الوصف |
| :--- | :--- |
| **🔐 نظام المصادقة الآمن** | تسجيل دخول آمن، إنشاء حسابات جديدة، حماية من هجمات CSRF و SQL Injection. |
| **👥 إدارة المستخدمين الشاملة** | لوحة تحكم متقدمة للإدارة تتيح إضافة وتعديل وحذف المستخدمين بسهولة. |
| **⏰ إدارة الاشتراكات الدقيقة** | تحديد مدة الاشتراك بالثواني والدقائق، عداد تنازلي مباشر، تعطيل تلقائي للخدمات. |
| **🎨 واجهة مستخدم احترافية** | تصميم عصري ومتجاوب باستخدام Bootstrap 5، تأثيرات بصرية متقدمة، تجربة مستخدم محسنة. |
| **🛠️ أدوات التثبيت والاختبار** | معالج إعداد تلقائي، نظام اختبار شامل، توثيق كامل وتعليمات التثبيت. |
| **📈 تقارير وإحصائيات** | عرض إحصائيات شاملة عن المستخدمين والاشتراكات، مع إمكانية تتبع النشاط. |

---

## 🔧 شرح عملي ونظري

### 🕒 1. نظام الاشتراكات والمؤقت

#### **الشرح النظري:**
نظام الاشتراكات يعتمد على تخزين تاريخ بدء وانتهاء الاشتراك في قاعدة البيانات. عند إنشاء اشتراك جديد، يتم حساب تاريخ الانتهاء بناءً على المدة المحددة (بالثواني). يتم التحقق من صحة الاشتراك بشكل دوري من خلال مقارنة تاريخ الانتهاء مع الوقت الحالي. إذا كان تاريخ الانتهاء قد مضى، يعتبر الاشتراك منتهيًا.

#### **الشرح العملي:**
- **إنشاء الاشتراك:** في `admin/manage_subscription.php`، يقوم المدير بتحديد مدة الاشتراك (أيام، ساعات، دقائق، ثواني). يتم تحويل هذه المدة إلى ثواني وتخزينها في جدول `subscriptions` مع تاريخ البدء والانتهاء.
- **التحقق من الاشتراك:** في `user/dashboard.php`، يتم استدعاء دالة `isSubscriptionValid()` للتحقق من صحة الاشتراك. هذه الدالة تقارن تاريخ الانتهاء مع الوقت الحالي.
- **المؤقت:** في `user/dashboard.php`، يتم استخدام JavaScript لتحديث عداد تنازلي يعرض الوقت المتبقي. يتم الحصول على الوقت المتبقي من دالة `getRemainingTime()` التي تحسب الفرق بين تاريخ الانتهاء والوقت الحالي.
- **التحقق الدوري:** يتم استخدام `fetch` في JavaScript لاستدعاء `user/check_subscription.php` كل 5 دقائق للتحقق من حالة الاشتراك وتحديث الصفحة إذا انتهى الاشتراك.

### 🔑 2. نظام الجلسات

#### **الشرح النظري:**
الجلسات (Sessions) هي آلية لتخزين معلومات المستخدم عبر صفحات متعددة. عند تسجيل الدخول، يتم إنشاء جلسة فريدة للمستخدم وتخزين معرف المستخدم ومعلومات أخرى في متغير `$_SESSION`. يتم استخدام هذه المعلومات للتحقق من هوية المستخدم في كل صفحة.

#### **الشرح العملي:**
- **بدء الجلسة:** يتم استدعاء `session_start()` في بداية كل صفحة تتطلب الوصول إلى معلومات الجلسة.
- **تخزين المعلومات:** عند تسجيل الدخول بنجاح في `auth/login_process.php`، يتم تخزين `user_id` و `username` و `is_admin` في `$_SESSION`.
- **التحقق من الجلسة:** في كل صفحة محمية، يتم استدعاء دالة `requireLogin()` للتحقق من وجود جلسة نشطة. إذا لم تكن هناك جلسة، يتم توجيه المستخدم إلى صفحة تسجيل الدخول.
- **انتهاء الجلسة:** يتم تعيين مهلة للجلسة في `includes/config.php` (`SESSION_TIMEOUT`). إذا لم يكن هناك نشاط خلال هذه المهلة، تنتهي الجلسة تلقائيًا.
- **تسجيل الخروج:** عند تسجيل الخروج في `admin/logout.php`، يتم استدعاء `logoutUser()` التي تقوم بتدمير الجلسة وإزالة جميع متغيراتها.

---

## 💻 متطلبات النظام

- **PHP:** 7.4 أو أحدث
- **MySQL:** 5.7 أو أحدث
- **خادم ويب:** Apache أو Nginx
- **امتدادات PHP:** PDO, pdo_mysql, session, json

---

## 🚀 دليل التثبيت السريع

### 1. تحميل الملفات
```bash
# استنساخ المستودع
git clone [repository-url]
cd subscription-system
```

### 2. إعداد قاعدة البيانات
```sql
-- إنشاء قاعدة بيانات جديدة
CREATE DATABASE subscription_system CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- إنشاء مستخدم جديد (اختياري)
CREATE USER 'sub_user'@'localhost' IDENTIFIED BY 'password123';
GRANT ALL PRIVILEGES ON subscription_system.* TO 'sub_user'@'localhost';
FLUSH PRIVILEGES;
```

### 3. تشغيل معالج الإعداد
1. افتح المتصفح واذهب إلى: `http://localhost/subscription-system/setup.php`
2. اتبع خطوات المعالج لإعداد قاعدة البيانات وإنشاء حساب الإدارة.
3. **هام:** احذف ملف `setup.php` بعد اكتمال التثبيت لأسباب أمنية.

### 4. اختبار النظام
- اذهب إلى: `http://localhost/subscription-system/test_system.php`
- تأكد من نجاح جميع الاختبارات.

---

## 🛠️ هيكل المشروع

```
website/
├── index.php                 # الصفحة الرئيسية
├── README.md                 # ملف التوثيق
├── database_schema.sql       # مخطط قاعدة البيانات
├── auth/                     # نظام المصادقة
├── admin/                    # لوحة تحكم الإدارة
├── user/                     # لوحة تحكم المستخدم
├── includes/                 # الملفات المساعدة
├── css/                      # ملفات التصميم
├── js/                       # ملفات JavaScript
└── img/                      # الصور والأيقونات
```

---

## 🛡️ الأمان

### تدابير الحماية المطبقة
- **تشفير كلمات المرور:** استخدام `password_hash()` لتشفير كلمات المرور.
- **حماية من SQL Injection:** استخدام Prepared Statements لمنع هجمات حقن SQL.
- **حماية من CSRF:** استخدام رموز الأمان (CSRF tokens) لمنع هجمات تزوير الطلبات عبر المواقع.
- **تنظيف البيانات:** استخدام دوال لتنظيف البيانات المدخلة من قبل المستخدم.
- **إدارة آمنة للجلسات:** إدارة الجلسات بشكل آمن مع مهلة انتهاء تلقائية.
- **تسجيل شامل للأنشطة:** تسجيل جميع الأنشطة الهامة في النظام.

### أفضل الممارسات الأمنية
- **استخدام HTTPS:** تأكد من استخدام HTTPS في البيئة الإنتاجية لتشفير الاتصال.
- **تحديث النظام:** حافظ على تحديث PHP و MySQL بانتظام.
- **مراقبة السجلات:** راقب سجلات النشاط بانتظام للكشف عن أي نشاط مشبوه.
- **النسخ الاحتياطي:** قم بعمل نسخ احتياطية دورية لقاعدة البيانات والملفات.

---

## 🎨 التخصيص

### تغيير التصميم
يمكن تخصيص الألوان والتصميم من خلال تعديل ملف `css/style.css`.

### إضافة ميزات جديدة
1. إنشاء ملفات PHP جديدة في المجلد المناسب.
2. تحديث قاعدة البيانات إذا لزم الأمر.
3. إضافة الروابط في واجهة المستخدم.
4. تحديث ملف `includes/functions.php` للدوال الجديدة.

---

## ❓ استكشاف الأخطاء وإصلاحها

| المشكلة | الحل |
| :--- | :--- |
| **خطأ في الاتصال بقاعدة البيانات** | تحقق من إعدادات `config.php`، تأكد من تشغيل MySQL، تحقق من صلاحيات المستخدم. |
| **مشاكل في الجلسات** | تأكد من تمكين الجلسات في PHP، تحقق من صلاحيات مجلد الجلسات. |
| **مشاكل في التصميم** | تحقق من تحميل ملفات Bootstrap، تأكد من صحة مسارات CSS، تحقق من وحدة تحكم المتصفح. |

---

## 🤝 الدعم والمساهمة

نرحب بالمساهمات! يرجى اتباع الخطوات التالية:
1. عمل Fork للمستودع.
2. إنشاء فرع جديد للميزة.
3. إجراء التغييرات المطلوبة.
4. إرسال Pull Request.

---

## 📜 الترخيص

هذا المشروع مرخص تحت رخصة MIT. راجع ملف `LICENSE` للمزيد من التفاصيل.

---

## 📞 معلومات الاتصال

- **البريد الإلكتروني:** support@example.com
- **الموقع الإلكتروني:** https://example.com
- **الهاتف:** +966-XX-XXX-XXXX

---

تم تطوير هذا النظام بعناية فائقة لضمان الأمان والأداء العالي. نأمل أن يلبي احتياجاتكم في إدارة الاشتراكات بكفاءة عالية.


